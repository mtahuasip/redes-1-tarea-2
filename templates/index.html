<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      :root {
        --primary-color: #2c3e50;
        --secondary-color: #3498db;
        --background-color: #f9f9f9;
        --text-color: #333333;
        --border-color: #dddddd;
        --input-bg-color: #f1f1f1;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background-color: var(--background-color);
        color: var(--text-color);
        font-family: system-ui, sans-serif;
        font-size: 14px;
        line-height: 1.5;
      }

      main {
        max-width: 900px;
        margin: 2rem auto;
        padding: 2rem;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }

      header {
        text-align: center;
        margin-bottom: 2rem;
      }

      header h1 {
        color: var(--primary-color);
      }

      section {
        margin-bottom: 2rem;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
      }

      th,
      td {
        border: 1px solid var(--border-color);
        padding: 0.5rem;
        text-align: center;
      }

      th {
        background-color: var(--secondary-color);
        color: white;
      }

      form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-top: 1rem;
      }

      fieldset {
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 1rem;
        background-color: var(--input-bg-color);
      }

      legend {
        font-size: 1.2rem;
        font-weight: bold;
        color: var(--primary-color);
      }

      label {
        font-size: 1rem;
        color: var(--text-color);
        display: inline-block;
        margin-bottom: 0.5rem;
      }

      input[type="radio"] {
        margin-right: 0.5rem;
      }

      input[type="color"] {
        padding: 0;
        border: none;
        background-color: transparent;
        cursor: pointer;
      }

      button {
        background-color: var(--primary-color);
        color: white;
        border: none;
        padding: 0.6rem 1.2rem;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
        align-self: flex-start;
        transition: background-color 0.3s;
      }

      button:hover {
        background-color: var(--secondary-color);
      }

      .btn-link {
        color: var(--secondary-color);
        text-decoration: none;
        font-weight: bold;
      }

      .btn-link:hover {
        text-decoration: underline;
      }

      footer {
        text-align: center;
        margin-top: 2rem;
        padding-top: 1rem;
        border-top: 1px solid var(--border-color);
      }
    </style>

    <title>Redes I: Tarea 2 | Servidor Flask</title>
  </head>
  <body>
    <main id="main">
      <header>
        <h1>Tarea 2: Servidor Flask</h1>
        <p>Implementación de cookies y preferencias del usuario</p>
      </header>

      <section aria-labelledby="expiracion">
        <h2>Tiempo de expiración</h2>
        <div id="countdown">
          <span id="days">0</span> días <span id="hours">0</span> horas
          <span id="minutes">0</span> minutos
          <span id="seconds">0</span> segundos
        </div>
      </section>

      <section aria-labelledby="preferencias">
        <h2 id="preferencias">Seleccione tipo de letra y color</h2>

        <form action="/set-preferences" method="POST">
          <fieldset>
            <legend>Tipo de letra</legend>

            <div>
              <input type="radio" name="font" id="arial" value="Arial" />
              <label for="arial">Arial</label>
            </div>

            <div>
              <input
                type="radio"
                name="font"
                id="times"
                value="Times New Roman"
              />
              <label for="times">Times New Roman</label>
            </div>

            <div>
              <input
                type="radio"
                name="font"
                id="currier"
                value="Courier New"
              />
              <label for="currier">Courier New</label>
            </div>
          </fieldset>

          <fieldset>
            <legend>Color de fondo</legend>

            <label for="color">Seleccione un color</label>
            <input type="color" name="color" id="color" />
          </fieldset>

          <button type="submit">Guardar preferencias</button>
        </form>
      </section>

      <section aria-labelledby="enlaces">
        <h2 id="enlaces">Enlaces para visitar</h2>

        <table>
          <thead>
            <tr>
              <th>Nombre página</th>
              <th>Estado</th>
              <th>Acción</th>
            </tr>
          </thead>

          <tbody>
            <tr>
              <td>Universidad Mayor de San Andrés</td>
              <td>ESTADO</td>
              <td>
                <a
                  href="https://www.umsa.bo/"
                  class="btn-link"
                  target="_blank"
                  noreferrer
                  >Visitar</a
                >
              </td>
            </tr>
            <tr>
              <td>Facultad de Ciencias Puras y Naturales</td>
              <td>ESTADO</td>
              <td>
                <a
                  href="https://www.fcpn.edu.bo/"
                  class="btn-link"
                  target="_blank"
                  noreferrer
                  >Visitar</a
                >
              </td>
            </tr>
            <tr>
              <td>Carrera de Informática</td>
              <td>ESTADO</td>
              <td>
                <a
                  href="https://informatica.umsa.bo/"
                  class="btn-link"
                  target="_blank"
                  noreferrer
                >
                  Visitar
                </a>
              </td>
            </tr>
          </tbody>
        </table>
      </section>

      <footer>
        <h2>Integrantes</h2>
        <ul>
          <li>Nombre 1</li>
          <li>Nombre 2</li>
          <li>Nombre 3</li>
        </ul>
      </footer>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Función para obtener cookies por nombre
        function getCookie(name) {
          const value = `; ${document.cookie}`;
          const parts = value.split(`; ${name}=`);
          if (parts.length === 2) return parts.pop().split(";").shift();
        }

        // Obteniendo cookies
        const expiration = getCookie("expiration");
        const font = getCookie("font");
        const color = getCookie("color");
        const visitedLinks = getCookie("visited_links");

        console.log({ expiration, font, color, visitedLinks });

        // Contador para expiración de las cookies
        let targetDate;
        if (expiration) {
          let date = expiration.slice(1, expiration.length - 1);
          date = new Date(date);

          targetDate = date.getTime();
        } else {
          document.getElementById("countdown").innerHTML = "No establecida";
          return;
        }

        function startCountdown() {
          const countdownTimer = setInterval(function () {
            const now = new Date().getTime();
            const difference = targetDate - now;

            const days = Math.floor(difference / (1000 * 60 * 60 * 24));
            const hours = Math.floor(
              (difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
            );
            const minutes = Math.floor(
              (difference % (1000 * 60 * 60)) / (1000 * 60)
            );
            const seconds = Math.floor((difference % (1000 * 60)) / 1000);

            document.getElementById("days").textContent = days;
            document.getElementById("hours").textContent = hours;
            document.getElementById("minutes").textContent = minutes;
            document.getElementById("seconds").textContent = seconds;

            if (difference < 0) {
              clearInterval(countdownTimer);
              document.getElementById("countdown").innerHTML =
                "Tiempo expirado";
            }
          }, 1000);
        }

        startCountdown();

        // Cambiando tipo de letra si hay una cookie disponible para font-family
        if (font)
          document.getElementById("main").style.fontFamily = font.split("=")[1];

        // Cambiando color de letra si hay una cookie disponible para color
        if (color) {
          document.getElementById("color").value = color;

          const children = document.querySelectorAll("#main *");
          children.forEach((child) => {
            if (
              child.tagName.toLowerCase() !== "button" &&
              child.tagName.toLowerCase() !== "a"
            ) {
              child.style.color = color;
            }
          });
        }
      });
    </script>
  </body>
</html>
